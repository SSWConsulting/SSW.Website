---
seo:
  title: 'Container Integration Tests w/ MSSQL, SMTP, Azurite - No Mocks'
  description: >-
    Ditch Mock integration tests. Use Docker Containers with MSSQL, SMTP,
    Azurite for real-world confidence. Catch bugs early in production-like
    scenarios
bannerImg: /images/articles/test-containers-header-image.png
title: >-
  Integration Testing with Containers: Moving Beyond Mocks for Real-World
  Confidence with MSSQL, SMTP, and Azurite 
subTitle: "Ever feel like you’re acing every practice session, only to choke when game time arrives? That’s exactly how integration testing can go if you rely solely on mocks.\n\n**That's why our team relies on containerized resources such as MSSQL, SMTP4DEV, and Azurite.**\n\nBy running these services in Docker containers, we create an environment that mirrors production closely, catching those hidden bugs before they ever get a chance to surprise you in the real world. \n\n## Why we bother with Test Containers instead of Mocks?\_\n\nMocks can be handy because they let you fake external services. The problem is that mocks can miss important details. For example, an email mock might confirm that you tried to send something, but it won't confirm that your messages have the correct format, attachments, or recipient addresses. If your code thinks it's sending an email, but the actual email server rejects it, you could end up with a production crisis on your hands. Test Containers give you the real thing in a controlled environment.\_\n\nHaving a suite of realistic tests, allows us to refactor our projects and update versions of .NET with confidence. Without a good suite of tests these changes are a real risk.\_\n\n## Using the .NET TestContainers Library\_\n\nThe .NET TestContainers library ([Testcontainers for .NET](https://dotnet.testcontainers.org/))\_ is the friendly assistant that helps you spin up actual Docker containers for services like MSSQL, SMTP4DEV, and Azurite. It hides the messy details of Docker commands, so you can focus on writing code. Whether you're on your local machine or using GitHub Actions in your pipeline, these containers provide a consistent, production-like experience.\_\n\nHere’s a quick example of how you might spin up an MSSQL container in your tests:\n\n```csharp\nusing Polly;\r\nusing Testcontainers.MsSql;\r\n\r\nnamespace Tests;\r\n\r\npublic class UnitTest1 : IAsyncLifetime\r\n{\r\n    private readonly DatabaseContainer _databaseContainer = new();\r\n\r\n    [Fact]\r\n    public void Test1()\r\n    {\r\n        // Test code goes here...\r\n    }\r\n\r\n    public async Task InitializeAsync() => await _databaseContainer.InitializeAsync();\r\n\r\n    public async Task DisposeAsync() => await _databaseContainer.DisposeAsync();\r\n}\r\n\r\npublic class DatabaseContainer : IAsyncDisposable\r\n{\r\n    private readonly MsSqlContainer _container = new MsSqlBuilder()\r\n        .WithImage(\"mcr.microsoft.com/mssql/server:2022-CU14-ubuntu-22.04\")\r\n        .WithName($\"CleanArchitecture-IntegrationTests-{Guid.CreateVersion7()}\")\r\n        .WithPassword(\"Password123\")\r\n        .WithPortBinding(1433, true)\r\n        .WithAutoRemove(true)\r\n        .Build();\r\n\r\n    private const int MaxRetries = 5;\r\n\r\n    public string? ConnectionString { get; private set; }\r\n\r\n    public async Task InitializeAsync()\r\n    {\r\n        await StartWithRetry();\r\n        ConnectionString = _container.GetConnectionString();\r\n    }\r\n\r\n    private async Task StartWithRetry()\r\n    {\r\n        // Add resilience to the container startup\r\n        var policy = Policy.Handle<InvalidOperationException>()\r\n            .WaitAndRetryAsync(MaxRetries, _ => TimeSpan.FromSeconds(5));\r\n\r\n        await policy.ExecuteAsync(async () => { await _container.StartAsync(); });\r\n    }\r\n\r\n    public async ValueTask DisposeAsync()\r\n    {\r\n        await _container.StopAsync();\r\n        await _container.DisposeAsync();\r\n        GC.SuppressFinalize(this);\r\n    }\r\n}\n```\n"
author: content/presenters/daniel-mackay.mdx
sidebarPanel:
  title: 2-Day Pre-Migration Assessment Engagement
  description: >-
    Get a solid foundation for your .NET 8 migration project, ensuring you are
    well-prepared to tackle the migration with confidence.
  showSidebarPanel: true
  actionUrl: /
  actionText: Learn more
callToAction:
  title: Talk to us about your project
  subTitle: Connect with our Account Managers to discuss how we can help.
  showCallToAction: true
  buttonText: Book a FREE Initial Meeting
  animated: true
  buttonSubtitle: or call +61 2 9953 3000
---

