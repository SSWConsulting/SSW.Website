name: Fetch SSW - People Profiles

on:
  workflow_dispatch:
  schedule:
    - cron: "0 * * * TUE"

jobs:
  fetch-data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Checkout People Profiles
        uses: actions/checkout@v4
        with:
          #TODO: Update to SSWConsulting
          repository: "tkapa/SSW.People.Profiles"
          path: temp-profiles

      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: corepack enable pnpm
      - run: pnpm add -w gray-matter

      - name: Fetch SSW.People.Profiles
        uses: actions/github-script@v7
        with:
          script: |
            const script = require(`${process.env.GITHUB_WORKSPACE}/.github/workflows/get-people-profiles.js`);

            script({
              github,
              context,
              peopleDirectory: `${process.env.GITHUB_WORKSPACE}/temp-profiles`,
              websiteContentPath: `${process.env.GITHUB_WORKSPACE}/content`,
              websitePublicPath: `${process.env.GITHUB_WORKSPACE}/public`,
              presentersPath: `presenters`,
              peopleImagePath: `images/people`
            });

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "Fetch People Profiles"
          title: "Auto - Fetch People Profiles"
          body: >
            Created by GitHub Action.
            - Syncs data from [SSW.People.Profiles](https://github.com/SSWConsulting/SSW.People.Profiles)
          branch: "sync/people-profiles"
          # We only expect changes to these folders
          add-paths: |
            content/*
            public/*
